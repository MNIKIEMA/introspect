(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[594],{147:(e,s,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/manage-users",function(){return r(1224)}])},6389:(e,s,r)=>{"use strict";r.d(s,{A:()=>n});var t=r(5105),a=r(9035),o=r.n(a);let n=()=>(0,t.jsxs)(o(),{children:[(0,t.jsx)("title",{children:"Defog.ai - AI Assistant for Data Analysis"}),(0,t.jsx)("meta",{name:"description",content:"Train your AI data assistant on your own device"}),(0,t.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,t.jsx)("link",{rel:"icon",href:"/favicon.ico"})]})},3360:(e,s,r)=>{"use strict";r.d(s,{A:()=>i});var t=r(5105),a=r(8101),o=r(3472),n=r(5379),d=r(6159),l=r(4799);let i=e=>{let{id:s,userType:r,children:i,rootClassNames:c="",contentClassNames:u="max-h-full h-full",containerClassNames:m="flex flex-col md:min-h-screen relative container mx-auto"}=e,[g,h]=(0,a.useState)([]),y=(0,o.useRouter)(),p=e=>{y.push(e)},x=()=>{localStorage.removeItem("defogUser"),localStorage.removeItem("defogToken"),localStorage.removeItem("defogUserType"),p("/log-in")},f=(0,d.usePathname)();return(0,a.useEffect)(()=>{h(("admin"==r?[{title:"Admin",href:"#!",children:[{key:"manage-database",title:"Manage Database",href:"/extract-metadata"},{key:"manage-users",title:"Manage Users",href:"/manage-users"},{key:"align-model",title:"Align Model",href:"/align-model"},{key:"evaluate-model",title:"Evaluate Model",href:"/evaluate-model"}]},{key:"query-data",title:"Query Data",href:"/query-data"},{key:"reports",title:"Reports",href:"/reports"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:x}]:r?[{key:"query-data",title:"Query Data",href:"/query-data"},{key:"reports",title:"Reports",href:"/reports"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:x}]:[]).map(e=>(e.current=e.href==f,e)).map(e=>(e.children&&(e.children=e.children.map(e=>(e.current=e.href==f,e))),e)))},[r]),(0,t.jsxs)("div",{className:(0,l.QP)(m,c),children:[g.length?(0,t.jsx)(n.jq,{rootClassNames:(0,l.QP)("border-b dark:border-dark-border","bg-white dark:bg-dark-bg-primary","text-primary-text dark:text-dark-text-primary"),items:g.map(e=>({...e,classNames:(0,l.QP)(e.classNames,"hover:bg-gray-100 dark:hover:bg-dark-hover",e.current&&"bg-gray-100 dark:bg-dark-hover")}))}):(0,t.jsx)(t.Fragment,{}),(0,t.jsx)("div",{className:u,children:i})]})}},4580:(e,s,r)=>{"use strict";r.d(s,{A:()=>t});let t=(0,r(9834).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},1224:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>j});var t=r(5105),a=r(8101),o=r(3472),n=r(6389),d=r(3360),l=r(4379),i=r(9834);let c=(0,i.A)("FileUp",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]]);var u=r(9692),m=r(576),g=r.n(m),h=r(5379);let y=e=>{let{loading:s,getUserDets:r}=e,[o,n]=(0,a.useState)([{username:"",password:"",userType:""}]),[d,i]=(0,a.useState)("username,password,user_type\n"),[m,y]=(0,a.useState)(""),[p,x]=(0,a.useState)(!1),f=(0,a.useContext)(h.oS),b=a.useRef(null);(0,a.useEffect)(()=>{let e=o.filter(e=>e.username&&e.password&&e.userType).map(e=>"".concat(e.username,",").concat(e.password,",").concat(e.userType)).join("\n");i("username,password,user_type\n".concat(e))},[o]);let w=e=>(g().parse(e,{error:e=>{f.error("There was an error parsing the CSV file.")},complete:e=>{n(e.data.map(e=>({username:e.username,password:e.password,userType:e.user_type}))),x(!0),y(""),f.success("CSV file parsed successfully. Please hit 'Add Users' to proceed.")},header:!0,skipEmptyLines:!0}),!1),k=async e=>{e.preventDefault();try{let e=localStorage.getItem("defogToken"),s="username,password,user_type"!==d.trim()?{users_csv:d,token:e}:{gsheets_url:m,token:e},t=await fetch((0,l.A)("http","admin/add_users"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let a=await t.json();if("success"===a.status)f.success("Users added successfully! Refreshing the user data..."),n([{username:"",password:"",userType:""}]);else throw Error(a.message||"There was an error adding the users.");await r()}catch(e){console.error("Error:",e),f.error(e.message||"There was an error adding the users. Please try again.")}finally{x(!1),i("username,password,user_type\n")}};return(0,t.jsxs)("div",{className:"w-3/4 p-6 border border-gray-200 rounded-lg shadow-lg",children:[(0,t.jsxs)("h1",{className:"flex items-center justify-center text-2xl mb-8",children:[(0,t.jsx)(c,{size:24,className:"mr-2"}),"Add Users via File"]}),(0,t.jsxs)("form",{onSubmit:k,className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-lg font-semibold mb-4",children:"Upload CSV File"}),(0,t.jsxs)("div",{className:"mb-4",children:[!p&&(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Expected columns in the file: username,password,user_type,allowed_dbs. For users that must login via SSO, please set the password column to blank."}),(0,t.jsx)("input",{type:"file",ref:b,accept:".csv",onChange:e=>{let s=e.target.files[0];s&&w(s)},className:"hidden",disabled:p||s}),(0,t.jsxs)("button",{type:"button",onClick:()=>{var e;return null===(e=b.current)||void 0===e?void 0:e.click()},disabled:p||s,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,t.jsx)(u.A,{size:20,className:"mr-2"}),p?"Uploaded":"Upload CSV"]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-lg font-semibold mb-4",children:"Or a paste publicly accessible Google Sheets URL"}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Google Sheets URL"}),(0,t.jsx)("input",{type:"text",value:m,onChange:e=>y(e.target.value),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",disabled:s})]})]}),p&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Generated CSV String"}),(0,t.jsx)("textarea",{value:d,readOnly:!0,rows:4,className:"mt-1 block w-full font-mono border border-gray-300 rounded-md shadow-sm py-2 px-3 bg-gray-100 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,t.jsx)("button",{type:"submit",disabled:"username,password,user_type"===d.trim()&&!m||s,className:"w-1/3 mx-auto block px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Add Users"})]})]})},p=(0,i.A)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var x=r(3184);let f=e=>{let{loading:s,getUserDets:r}=e,[o,n]=(0,a.useState)([{username:"",password:"",userType:"",userDb:[]}]),[d,i]=(0,a.useState)("username,password,user_type,allowed_dbs\n"),[c,u]=(0,a.useState)([]),m=(0,a.useContext)(h.oS),g=async()=>{let e=localStorage.getItem("defogToken"),s=await fetch((x.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"")+"/get_db_names",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})});if(!s.ok)throw Error("Failed to get api key names - are you sure your network is working?");u((await s.json()).db_names)};(0,a.useEffect)(()=>{g();let e=o.filter(e=>e.username&&e.userType).map(e=>"".concat(e.username,",").concat(e.password||"",",").concat(e.userType,",").concat(e.userDb.join("|"))).join("\n");i("username,password,user_type,allowed_dbs\n".concat(e))},[o]);let y=(e,s,r)=>{let t=[...o];t[e][s]=r,n(t)},f=async e=>{e.preventDefault();let s=localStorage.getItem("defogToken"),t=await fetch((0,l.A)("http","admin/add_users"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({users_csv:d,token:s})});"success"===(await t.json()).status?(m.success("Users added successfully! Refreshing the user data..."),n([{username:"",password:"",userType:"",userDb:[]}])):m.error("There was an error adding the users. Please try again."),await r()};return(0,t.jsxs)("div",{className:"w-3/4 p-6 border border-gray-200 rounded-lg shadow-lg",children:[(0,t.jsxs)("h1",{className:"flex items-center justify-center text-2xl mb-8",children:[(0,t.jsx)(p,{size:24,className:"mr-2"}),"Add Users Manually"]}),(0,t.jsxs)("form",{onSubmit:f,className:"w-full space-y-6",children:[o.map((e,r)=>(0,t.jsxs)("div",{className:"flex space-x-4 mb-4",children:[(0,t.jsxs)("div",{className:"w-1/4",children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Username",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)("input",{type:"text",className:"w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2",value:e.username,onChange:e=>y(r,"username",e.target.value),required:!0,disabled:s})]}),(0,t.jsxs)("div",{className:"w-1/4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password (leave blank for SSO users)"}),(0,t.jsx)("input",{type:"password",className:"w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2",value:e.password,onChange:e=>y(r,"password",e.target.value),disabled:s})]}),(0,t.jsxs)("div",{className:"w-1/4",children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["User Type",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)("select",{className:"w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2",value:e.userType,onChange:e=>y(r,"userType",e.target.value),required:!0,disabled:s,children:[(0,t.jsx)("option",{value:"",children:"Select type"}),(0,t.jsx)("option",{value:"admin",children:"Admin"}),(0,t.jsx)("option",{value:"general",children:"General"})]})]}),(0,t.jsxs)("div",{className:"w-1/4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Allowed DBs (leave blank for all DBs)"}),(0,t.jsx)("select",{multiple:!0,className:"w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2",value:e.userDb,onChange:e=>y(r,"userDb",Array.from(e.target.selectedOptions,e=>e.value)),disabled:s,children:c.map(e=>(0,t.jsx)("option",{value:e,children:e},e))})]})]},r)),(0,t.jsx)("button",{type:"button",onClick:()=>n([...o,{username:"",password:"",userType:"",userDb:[]}]),className:"w-full py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-gray-700 bg-gray-100 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",disabled:s,children:"Add Another User"}),"username,password,user_type,allowed_dbs"!==d.trim()&&(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Generated CSV String"}),(0,t.jsx)("textarea",{value:d,readOnly:!0,rows:2,className:"w-full font-mono border border-gray-300 rounded-md shadow-sm bg-gray-100 p-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,t.jsx)("button",{type:"submit",className:"w-1/3 mx-auto block mt-20 py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",disabled:s||"username,password,user_type,allowed_dbs"===d.trim(),children:"Add Users"})]})]})};var b=r(4580);let w=e=>{let{userDets:s,getUserDets:r,loading:o,setLoading:n}=e,d=(0,a.useContext)(h.oS),i=async e=>{n(!0);let s=localStorage.getItem("defogToken"),t=await fetch((0,l.A)("http","admin/delete_user"),{method:"POST",body:JSON.stringify({username:e,token:s}),headers:{"Content-Type":"application/json"}});"success"===(await t.json()).status?d.success("User deleted successfully! Refreshing the user data..."):d.error("There was an error deleting the user. Please try again."),await r(),n(!1)},c=[{title:"User ID",dataIndex:"username",key:"username",width:"30%"},{title:"User Type",dataIndex:"user_type",key:"user_type",width:"30%"},{title:"Allowed DBs",dataIndex:"allowed_dbs",key:"allowed_dbs",width:"30%"},{title:"Action",dataIndex:"__actions",key:"delete_user",width:"10%",render:(e,s)=>(0,t.jsx)(h.$n,{variant:"normal",icon:(0,t.jsx)(b.A,{}),onClick:()=>i(s.username),className:"hover:bg-gray-100 dark:hover:bg-gray-700"})}];return(0,t.jsx)("div",{className:"w-4/6 max-h-screen overflow-y-auto mb-4",children:(0,t.jsxs)("div",{className:"relative mt-10",children:[o&&(0,t.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/70 dark:bg-gray-900/70 backdrop-blur-[1px] z-10",children:[(0,t.jsx)(h.c5,{classNames:"text-blue-500 h-6 w-6"}),(0,t.jsx)("span",{className:"mt-2 text-sm font-medium text-gray-600 dark:text-gray-300",children:"Getting Latest Users Data"})]}),(0,t.jsx)(h.XI,{columns:c,rows:s.map((e,s)=>({...e,key:"row-".concat(s),__origIndex:s})),rowCellRender:e=>{let{cellValue:s,row:r,dataIndex:a,column:o}=e;return"function"==typeof o.render?(0,t.jsx)("td",{className:"px-6 py-4 text-left text-sm text-gray-700 dark:text-gray-200 border-b border-gray-200 dark:border-gray-700",children:o.render(s,r)},r.key+"-"+a):(0,t.jsx)("td",{className:"px-6 py-4 text-left text-sm text-gray-700 dark:text-gray-200 border-b border-gray-200 dark:border-gray-700 whitespace-nowrap",children:s},r.key+"-"+a)},headerCellRender:e=>{let{column:s}=e;return(0,t.jsx)("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-900 dark:text-gray-100 bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",style:{width:s.width},children:s.title},s.key)},rootClassNames:"border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg bg-white dark:bg-dark-bg-secondary overflow-hidden",pagination:{defaultPageSize:10,showSizeChanger:!1},paginationPosition:"bottom",showSearch:!1})]})})},k=(0,i.A)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),j=()=>{let[e,s]=(0,a.useState)(!1),[r,i]=(0,a.useState)([]),c=(0,a.useContext)(h.oS),u=(0,o.useRouter)(),m=async()=>{s(!0);let e=localStorage.getItem("defogToken");if(!e){s(!1),c.error("It seems like there was no token found in your session. Please try to log in again.");return}let r=await fetch((0,l.A)("http","admin/get_users"),{method:"POST",body:JSON.stringify({token:e}),headers:{"Content-Type":"application/json"}}),t=await r.json();t.users?i(t.users):c.error("There was an error fetching the user data. Please try again."),s(!1)};return(0,a.useEffect)(()=>{let e=localStorage.getItem("defogUser"),s=localStorage.getItem("defogToken"),r=localStorage.getItem("defogUserType");if(!e||!s||!r){u.push("/log-in");return}s?m():u.push("/log-in")},[]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.A,{}),(0,t.jsxs)(d.A,{id:"manage-users",userType:"admin",children:[(0,t.jsxs)("div",{className:"flex justify-center items-center flex-col p-1 mt-5",children:[(0,t.jsxs)("h1",{children:[(0,t.jsx)(k,{size:48,color:"#1890ff"})," "]}),(0,t.jsx)("h1",{className:"text-3xl mt-4",children:"Manage Users"})]}),(0,t.jsx)("div",{className:"flex justify-center items-center flex-col p-1",children:(0,t.jsx)(w,{userDets:r,getUserDets:m,loading:e,setLoading:s})}),(0,t.jsx)("div",{className:"flex justify-center items-center flex-col p-1 w-full",children:(0,t.jsx)(y,{loading:e,getUserDets:m})}),(0,t.jsx)("div",{className:"flex justify-center items-center flex-col p-1 w-full mt-4 mb-4",children:(0,t.jsx)(f,{loading:e,getUserDets:m})})]})]})}},4379:(e,s,r)=>{"use strict";r.d(s,{A:()=>a});var t=r(3184);let a=(e,s)=>{if("http"!==e&&"ws"!==e)throw Error("Protocol not supported");return""!==s?"ws"===e?"".concat((t.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"").replace("http","ws"),"/").concat(s):"".concat(t.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"","/").concat(s):"".concat(t.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"")}}},e=>{var s=s=>e(e.s=s);e.O(0,[328,351,636,593,792],()=>s(147)),_N_E=e.O()}]);