(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[193],{4244:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/query-data",function(){return a(8598)}])},6389:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var r=a(5105),s=a(9035),o=a.n(s);let n=()=>(0,r.jsxs)(o(),{children:[(0,r.jsx)("title",{children:"Defog.ai - AI Assistant for Data Analysis"}),(0,r.jsx)("meta",{name:"description",content:"Train your AI data assistant on your own device"}),(0,r.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,r.jsx)("link",{rel:"icon",href:"/favicon.ico"})]})},3360:(e,t,a)=>{"use strict";a.d(t,{A:()=>d});var r=a(5105),s=a(8101),o=a(3472),n=a(5920),i=a(6159),l=a(4799);let d=e=>{let{id:t,userType:a,children:d,rootClassNames:h="",contentClassNames:c="max-h-full h-full",containerClassNames:u="flex flex-col md:min-h-screen relative container mx-auto"}=e,[m,f]=(0,s.useState)([]),g=(0,o.useRouter)(),y=e=>{g.push(e)},p=()=>{localStorage.removeItem("defogUser"),localStorage.removeItem("defogToken"),localStorage.removeItem("defogUserType"),y("/log-in")},x=(0,i.usePathname)();return(0,s.useEffect)(()=>{f(("admin"==a?[{title:"Admin",href:"#!",children:[{key:"manage-database",title:"Manage Database",href:"/extract-metadata"},{key:"align-model",title:"Align Model",href:"/align-model"}]},{key:"reports",title:"Reports",href:"/reports"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:p}]:a?[{key:"query-data",title:"Query Data",href:"/query-data"},{key:"reports",title:"Reports",href:"/reports"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:p}]:[]).map(e=>(e.current=e.href==x,e)).map(e=>(e.children&&(e.children=e.children.map(e=>(e.current=e.href==x,e))),e)))},[a]),(0,r.jsxs)("div",{className:(0,l.QP)(u,h),children:[m.length?(0,r.jsx)(n.jq,{rootClassNames:(0,l.QP)("border-b dark:border-dark-border","bg-white dark:bg-dark-bg-primary","text-primary-text dark:text-dark-text-primary"),items:m.map(e=>({...e,classNames:(0,l.QP)(e.classNames,"hover:bg-gray-100 dark:hover:bg-dark-hover",e.current&&"bg-gray-100 dark:bg-dark-hover")}))}):(0,r.jsx)(r.Fragment,{}),(0,r.jsx)("div",{className:c,children:d})]})}},8598:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>h});var r=a(5105),s=a(8101),o=a(6389),n=a(3360),i=a(5920),l=a(5149);function d(e){let{token:t,dbs:a,hideSqlTab:o=!1,hidePreviewTabs:n=!1,hiddenCharts:d=[],hideRawAnalysis:h=!1}=e,[c,u]=(0,s.useState)(null),[m,f]=(0,s.useState)(!0),[g,y]=(0,s.useState)(null);(0,s.useEffect)(()=>{fetch("".concat("http://localhost","/get_user_history"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t})}).then(e=>e.ok?e.json():{error:"Could not fetch user history"}).then(e=>{if(e.error){y(e.error);return}f(!1),u(e.history||{})})},[]);let p=(0,s.useCallback)((e,a)=>{if(e&&a)try{fetch("".concat("http://localhost","/update_user_history"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t,history:a,db_name:e})}).then(e=>e.json()).then(e=>{if(e.error)throw Error(e.error)})}catch(e){console.error(e)}},[]);return m||g||!c?(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:g?"".concat(g):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.c5,{})," Loading"]})}):(0,r.jsx)(l.sd,{initialDbList:a,hiddenCharts:["boxplot","histogram"],token:t,searchBarDraggable:!1,hidePreviewTabs:!1,apiEndpoint:"http://localhost",initialTrees:c,hideRawAnalysis:h,hideSqlTab:o,onTreeChange:(e,t)=>{p(e,t)}})}let h=()=>{let[e,t]=(0,s.useState)(""),[a,l]=(0,s.useState)(""),[h,c]=(0,s.useState)(""),[u,m]=(0,s.useState)([]),[f,g]=(0,s.useState)(!1),[y,p]=(0,s.useState)({}),x=async e=>{g(!0);let t=await fetch("http://localhost/get_db_names",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})});if(!t.ok)throw g(!1),Error("Failed to get api key names - are you sure your network is working?");let a=await t.json();if(m(a.db_names),!(t=await fetch("http://localhost/get_non_admin_config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})})).ok)throw g(!1),Error("Failed to get non admin config - are you sure your network is working?");p(a=await t.json()),g(!1)};console.log(y),(0,s.useEffect)(()=>{let e=localStorage.getItem("defogToken"),a=localStorage.getItem("defogUserType");l(localStorage.getItem("defogUser")),c(a),t(e),x(e)},[]);let k="admin"===h;return(0,r.jsxs)("div",{className:"max-h-screen h-screen",children:[(0,r.jsx)(o.A,{}),(0,r.jsx)(n.A,{id:"query-data",userType:h,containerClassNames:"max-h-screen h-screen flex flex-col",contentClassNames:"h-full max-h-full",children:e?f?(0,r.jsxs)("div",{className:"w-full h-full flex justify-center items-center text-gray-400 text-sm",children:["Loading DBs ",(0,r.jsx)(i.c5,{classNames:"ml-4"})]}):(0,r.jsx)(d,{token:e,devMode:!1,isAdmin:k,hideSqlTab:!k&&y.hide_sql_tab_for_non_admin,hidePreviewTabs:!k&&y.hide_preview_tabs_for_non_admin,hiddenCharts:k?[]:y.hidden_charts_for_non_admin||[],hideRawAnalysis:!k&&y.hide_raw_analysis_for_non_admin,dbs:(u.length>0?u:[]).map(e=>({name:e,keyName:e,predefinedQuestions:"Manufacturing"===e?["What is the average rejection rate by lot?","Is there a difference in the plasticity of components that are rejected vs accepted?"]:"Sales"===e?["Who are our top 5 customers by revenue?","What was the month on month change in revenue?"]:"Slack"===e?["What is the count of number of queries by db type in the last 30 days, except for queries made by jp@defog.ai?","Which users have the most queries?"]:["Show me any 5 rows from the first table"]}))}):(0,r.jsx)("div",{className:"w-full h-full flex justify-center items-center text-gray-400 text-sm",children:"No token found. Please log out and log back in."})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[382,328,429,149,636,593,792],()=>t(4244)),_N_E=e.O()}]);