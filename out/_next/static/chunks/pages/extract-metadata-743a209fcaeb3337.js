(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[99],{97362:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/extract-metadata",function(){return a(16334)}])},31143:function(e,t,a){"use strict";var s=a(28598),o=a(1887),n=a.n(o);t.Z=()=>(0,s.jsxs)(n(),{children:[(0,s.jsx)("title",{children:"Defog.ai - AI Assistant for Data Analysis"}),(0,s.jsx)("meta",{name:"description",content:"Train your AI data assistant on your own device"}),(0,s.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,s.jsx)("link",{rel:"icon",href:"/favicon.ico"})]})},62429:function(e,t,a){"use strict";var s=a(28598),o=a(82684),n=a(91568),l=a(79869),i=a(34376);t.Z=e=>{let{id:t,userType:a,children:r}=e,{Content:d,Sider:c}=l.Layout,[h,p]=(0,o.useState)([]),[u,m]=(0,o.useContext)(n._),g=(0,i.useRouter)(),redirect=e=>{g.push(e)},logout=()=>{localStorage.removeItem("defogUser"),localStorage.removeItem("defogToken"),localStorage.removeItem("defogUserType"),m({user:null,token:null,userType:null}),redirect("/log-in")};return(0,o.useEffect)(()=>{p("admin"==a?[{key:"manage-database",title:"Manage Database",icon:(0,s.jsx)("a",{onClick:()=>redirect("/extract-metadata"),children:"\uD83D\uDCBE Manage DB"})},{key:"manage-users",title:"Manage Users",icon:(0,s.jsx)("a",{onClick:()=>redirect("/manage-users"),children:"\uD83D\uDD10 Manage Users"})},{key:"view-notebooks",title:"View your notebook",icon:(0,s.jsx)("a",{onClick:()=>redirect("/view-notebooks"),children:"\uD83D\uDCD2 Your Notebooks"})},{key:"logout",title:"Logout",icon:(0,s.jsx)("a",{onClick:logout,children:"â†ª Logout"})}]:a?[{key:"view-notebooks",title:"View your notebook",icon:(0,s.jsx)("a",{onClick:()=>redirect("/view-notebooks"),children:"Your Notebooks"})},{key:"logout",title:"Logout",icon:(0,s.jsx)("a",{onClick:logout,children:"Logout"})}]:[])},[a]),(0,s.jsx)(l.Layout,{style:{height:"100vh"},children:(0,s.jsxs)(d,{children:[h.length?(0,s.jsx)(c,{style:{height:"100vh",position:"fixed"},children:(0,s.jsx)(l.v2,{style:{width:200,paddingTop:"2em",paddingBottom:"2em"},mode:"inline",selectedKeys:[t],items:h})}):(0,s.jsx)(s.Fragment,{}),(0,s.jsx)("div",{style:{paddingLeft:240,paddingTop:30,backgroundColor:"#f5f5f5"},children:r})]})})}},16334:function(e,t,a){"use strict";a.r(t);var s=a(28598),o=a(82684),n=a(34376),l=a(91568),i=a(31143),r=a(62429),d=a(79869),c=a(99263),h=a(81298);t.default=()=>{let{Option:e}=d.Select,[t,a]=(0,o.useState)(null),[p,u]=(0,o.useState)({}),[m,g]=(0,o.useState)([]),[x,y]=(0,o.useState)(!1),[b,f]=(0,o.useState)(!1),[j,w]=(0,o.useState)([]),[k,_]=(0,o.useContext)(l._),[v,T]=(0,o.useState)([]),S=(0,n.useRouter)(),[C,D]=(0,o.useState)("admin"),getTables=async()=>{let e=k.token;if(!e)return;let t=await fetch("http://".concat("DEFOGHOSTNAME","/integration/get_tables_db_creds"),{method:"POST",body:JSON.stringify({token:e})}),s=await t.json();s.error||(console.log(s),a(s.db_type),u(s.db_creds),g(s.tables),T(s.selected_tables))},getMetadata=async()=>{let e=k.token;if(!e)return;let t=await fetch("http://".concat("DEFOGHOSTNAME","/integration/get_metadata"),{method:"POST",body:JSON.stringify({token:e})}),a=await t.json();a.error||w((null==a?void 0:a.metadata)||[])};(0,o.useEffect)(()=>{y(!0);let e=k.userType,t=k.token;if(!e){let a=localStorage.getItem("defogUser");if(t=localStorage.getItem("defogToken"),e=localStorage.getItem("defogUserType"),!a||!t||!e){S.push("/log-in");return}_({user:a,token:t,userType:e})}D(e),void 0===e?S.push("/log-in"):"admin"!==e&&S.push("/"),getTables().then(()=>{getMetadata().then(()=>{y(!1)})})},[k,k.token]);let I={postgres:["host","port","user","password","database"],mysql:["host","port","user","password","database"],redshift:["host","port","user","password","database"],snowflake:["account","warehouse","user","password"],databricks:["server_hostname","access_token","http_path","schema"]};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Z,{}),(0,s.jsxs)(r.Z,{id:"manage-database",userType:"admin",children:[(0,s.jsx)("h1",{style:{paddingBottom:"1em"},children:"Extract Metadata"}),void 0!==I[t]&&(0,s.jsxs)(d.X2,{type:"flex",height:"100vh",children:[(0,s.jsx)(d.JX,{md:{span:8},xs:{span:24},children:(0,s.jsxs)("div",{children:[(0,s.jsxs)(d.l0,{name:"db_creds",labelCol:{span:8},wrapperCol:{span:16},style:{maxWidth:400},disabled:b,onFinish:async e=>{e={db_creds:e,db_type:e.db_type||t,token:k.token},f(!0);try{let t=await fetch("http://".concat("DEFOGHOSTNAME","/integration/generate_tables"),{method:"POST",body:JSON.stringify(e)}),a=await t.json();a.error?d.yw.error(a.error):g(a.tables)}catch(e){console.log(e)}f(!1)},children:[(0,s.jsx)(d.l0.Item,{name:"db_type",label:"Database Type",rootClassName:"db_type",children:(0,s.jsx)(d.Select,{style:{width:"100%"},onChange:e=>{a(e)},defaultValue:t,options:["databricks","mysql","postgres","redshift","snowflake"].map(e=>({value:e,key:e,label:e}))},"db-type-"+t)}),void 0!==I[t]&&I[t].map(e=>(0,s.jsx)(d.l0.Item,{label:e,name:e,initialValue:p[e],children:(0,s.jsx)(d.II,{style:{width:"100%"}})},t+"_"+e+"_"+p[e])),(0,s.jsx)(d.l0.Item,{wrapperCol:{span:24},children:(0,s.jsx)(d.zx,{type:"primary",style:{width:"100%"},htmlType:"submit",loading:x,children:"Get Tables"})})]}),m.length>0&&(0,s.jsxs)(d.l0,{name:"db_tables",labelCol:{span:8},wrapperCol:{span:16},style:{maxWidth:400},disabled:x,onFinish:async e=>{y(!0);let t=e.tables.filter(e=>-1!==m.indexOf(e));if(0===t.length){d.yw.error(0===e.tables.length?"No tables selected":"None of the tables selected exist in the database"),y(!1);return}try{let t=await fetch("http://".concat("DEFOGHOSTNAME","/integration/generate_metadata"),{method:"POST",body:JSON.stringify({tables:e.tables.filter(e=>-1!==m.indexOf(e)),token:k.token})}),a=await t.json();a.error?d.yw.error(a.error):w((null==a?void 0:a.metadata)||[])}catch(e){console.log(e)}y(!1)},children:[(0,s.jsx)(d.l0.Item,{name:"tables",label:"Tables to index",initialValue:v,children:(0,s.jsx)(d.Select,{mode:"multiple",style:{width:"100%",maxWidth:400},placeholder:"Select tables to index",defaultValue:v,tagRender:e=>{let{label:t,closable:a,onClose:o,value:n}=e;return(0,s.jsx)(c.default,{rootClassName:"table-missing-popover",content:-1===m.indexOf(t)?"Table doesn't exist in this db":null,trigger:"hover",children:(0,s.jsx)(h.default,{closable:a,onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},onClose:o,rootClassName:"table-tag "+(-1===m.indexOf(t)?"table-missing":""),children:t})})},onChange:e=>{console.log(e),T(e)},children:m.map(t=>(0,s.jsx)(e,{value:t,children:t},t))})}),(0,s.jsx)(d.l0.Item,{wrapperCol:{span:24},children:(0,s.jsx)(d.zx,{type:"primary",style:{width:"100%",maxWidth:535},htmlType:"submit",children:"Extract Metadata"})})]})]})}),(0,s.jsxs)(d.JX,{md:{span:16},xs:{span:24},style:{paddingRight:"2em",height:600,overflowY:"scroll"},children:[j.length>0&&(0,s.jsx)(d.zx,{type:"primary",style:{width:"100%",maxWidth:535},disabled:x,loading:x,onClick:async()=>{y(!0);let e=await fetch("http://".concat("DEFOGHOSTNAME","/integration/update_metadata"),{method:"POST",body:JSON.stringify({token:k.token,metadata:j})}),t=await e.json();console.log(t),y(!1),void 0!==t.suggested_joins&&null!==t.suggested_joins&&""!==t.suggested_joins&&(document.getElementById("allowed-joins").value=t.suggested_joins),d.yw.success("Metadata updated successfully!")},children:"Update metadata on server"}),j.length>0?(0,s.jsxs)(d.X2,{style:{marginTop:"1em",position:"sticky",top:0,paddingBottom:"1em",paddingTop:"1em",backgroundColor:"white",zIndex:100},children:[(0,s.jsx)(d.JX,{xs:{span:24},md:{span:4},style:{overflowWrap:"break-word"},children:(0,s.jsx)("b",{children:"Table Name"})}),(0,s.jsx)(d.JX,{xs:{span:24},md:{span:4},style:{overflowWrap:"break-word"},children:(0,s.jsx)("b",{children:"Column Name"})}),(0,s.jsx)(d.JX,{xs:{span:24},md:{span:4},style:{overflowWrap:"break-word"},children:(0,s.jsx)("b",{children:"Data Type"})}),(0,s.jsx)(d.JX,{xs:{span:24},md:{span:12},children:(0,s.jsx)("b",{children:"Description (Optional)"})})]}):null,j.length>0&&j.map((e,t)=>(0,s.jsxs)(d.X2,{style:{marginTop:"1em"},children:[(0,s.jsx)(d.JX,{xs:{span:24},md:{span:4},style:{overflowWrap:"break-word"},children:e.table_name}),(0,s.jsx)(d.JX,{xs:{span:24},md:{span:4},style:{overflowWrap:"break-word"},children:e.column_name}),(0,s.jsx)(d.JX,{xs:{span:24},md:{span:4},style:{overflowWrap:"break-word"},children:e.data_type}),(0,s.jsx)(d.JX,{xs:{span:24},md:{span:12},children:(0,s.jsx)(d.II.TextArea,{placeholder:"Description of what this column does",value:e.column_description,autoSize:{minRows:2},onChange:e=>{let a=[...j];a[t].column_description=e.target.value,w(a)}})})]},t+"_"+e))]})]})]})]})}}},function(e){e.O(0,[456,128,774,888,179],function(){return e(e.s=97362)}),_N_E=e.O()}]);